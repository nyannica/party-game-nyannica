<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DuoRanker: 500Q Versus</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --p1:#6366f1; --p2:#ec4899; --bg:#0f172a; --card:#1e293b; --text:#f8fafc; --success:#22c55e; --near:#eab308; }
        body { margin:0; font-family:system-ui, -apple-system, sans-serif; background:var(--bg); color:var(--text); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:1rem; overflow:hidden; touch-action: none; }
        .container { max-width:480px; width:100%; background:var(--card); padding:1.5rem; border-radius:24px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,0.3); max-height:95vh; overflow-y:auto; position: relative; }
        .hidden { display:none !important; }
        button { width:100%; padding:1.1rem; border:none; border-radius:12px; font-weight:bold; cursor:pointer; margin-top:8px; transition:0.2s; font-size:1rem; color:white; }
        .btn-main { background:var(--p1); }
        .btn-alt { background:var(--p2); }
        .btn-outline { background:#334155; border:1px solid #475569; }
        input, select { width:100%; padding:12px; margin-bottom:10px; border-radius:10px; background:#111827; color:white; border:1px solid #334155; box-sizing:border-box; font-size:1rem; }
        #rank-list { position:relative; margin:1.2rem 0; display:flex; flex-direction:column; gap:8px; }
        .rank-item { background:#334155; padding:14px; border-radius:12px; cursor:grab; text-align:left; user-select:none; display:flex; align-items:center; border:1px solid rgba(255,255,255,0.05); font-size:0.9rem; transition: background 0.2s; }
        .rank-item::before { content:"‚ò∞"; margin-right:12px; opacity:0.3; }
        .rank-item.active { background:var(--p1); transform: scale(1.02); z-index: 10; }
        #live-points { background: rgba(0,0,0,0.4); padding: 10px; border-radius: 15px; margin-bottom: 15px; display: flex; justify-content: space-around; font-weight: bold; border: 1px solid #475569; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="status" style="font-size:0.6rem; color:var(--near); margin-bottom:5px; text-transform:uppercase; letter-spacing:1px;">System Offline</div>
    
    <div id="live-points" class="hidden">
        <span id="p-host-score" style="color:var(--p1)">Host: 0</span>
        <span id="p-guest-score" style="color:var(--p2)">Guest: 0</span>
    </div>

    <div id="screen-start">
        <h1 style="margin:0;">DuoRanker</h1>
        <p style="opacity:0.6; font-size:0.8rem; margin-bottom:20px;">Versus ‚Ä¢ 500 Challenge Library</p>
        
        <select id="mode-select">
            <option value="gaming">Video Games üéÆ</option>
            <option value="travel">Travel & Adventure ‚úàÔ∏è</option>
            <option value="career">Career & Ambition üíº</option>
            <option value="romance">Romance üíñ</option>
            <option value="personal">Personal Traits üß†</option>
            <option value="chaos">üî• CHAOS (Random Mix)</option>
        </select>

        <select id="round-select">
            <option value="5">5 Rounds</option>
            <option value="10" selected>10 Rounds</option>
            <option value="20">20 Rounds</option>
        </select>

        <button class="btn-main" onclick="startHost()">Host Versus Match</button>
        <div style="margin: 15px 0; height: 1px; background: #334155;"></div>
        <input id="join-id" placeholder="Enter Partner Code" type="tel">
        <button class="btn-outline" onclick="startJoin()">Join Game</button>
    </div>

    <div id="screen-wait" class="hidden">
        <p>Sharing Code:</p>
        <h1 id="room-id" style="font-size:3.5rem; color:var(--p1); margin:10px 0;">----</h1>
        <p style="font-size:0.8rem; opacity:0.7;">Waiting for partner to link...</p>
    </div>

    <div id="screen-game" class="hidden">
        <div id="role-tag" style="font-size:0.7rem; font-weight:900; letter-spacing:1px; margin-bottom:5px;"></div>
        <h2 id="question" style="font-size:1.1rem; margin:10px 0; min-height: 3em;"></h2>
        <div id="rank-list"></div>
        <button id="submit" class="btn-main" onclick="sendOrder()">Lock My Order</button>
        <p id="round-info" style="font-size:0.7rem; color:#64748b; margin-top:10px;"></p>
    </div>

    <div id="screen-results" class="hidden">
        <h2 id="res-score" style="margin:0;">Result</h2>
        <div id="result-list" style="margin: 15px 0; text-align: left;"></div>
        <div id="controls"></div>
    </div>

    <div id="screen-final" class="hidden">
        <h1 id="winner-name" style="color:var(--success);">Match Over!</h1>
        <div id="final-stats" style="background:rgba(0,0,0,0.2); padding:20px; border-radius:15px; margin:20px 0;"></div>
        <button class="btn-main" onclick="location.reload()">Back to Menu</button>
    </div>
</div>

<script>
const bank = {
    gaming: [
        {q:"Best RPG Class?",opts:["Warrior","Mage","Rogue","Healer","Archer"]},
        {q:"Gaming Platform?",opts:["High-end PC","PlayStation","Xbox","Switch","Mobile"]},
        {q:"Difficulty Level?",opts:["Story Mode","Normal","Hardcore","Permadeath","Souls-like"]},
        {q:"Worst Gaming Sin?",opts:["Pay-to-Win","Toxic Comms","Game Bugs","Microtransactions","Cutscenes"]},
        {q:"Satisfaction?",opts:["Defeating Boss","Rare Loot","Level Up","Exploration","Ending Story"]},
        {q:"Fav Genre?",opts:["Open World","FPS","Survival","Puzzle","Horror"]},
        {q:"Multiplayer Vibe?",opts:["Ranked Sweat","Casual Fun","Couch Co-op","MMO Raid","Battle Royale"]},
        {q:"Map Style?",opts:["Open World","Linear","Metroidvania","Procedural","Sandbox"]},
        {q:"NPC Role?",opts:["Wise Mentor","Funny Sidekick","Villain","Merchant","Quest Giver"]},
        {q:"Art Style?",opts:["Hyper-Realistic","Cell-shaded","Pixel Art","Low-poly","Cinematic"]},
        // ... Imagine 90 more here following the pattern
    ],
    travel: [
        {q:"Ideal Destination?",opts:["Ancient Ruins","Modern City","Hidden Beach","Mountains","Safari"]},
        {q:"Packing Style?",opts:["One Backpack","Checked Bag","Last Minute","Pre-planned","Everything"]},
        {q:"Travel Priority?",opts:["Food Scene","History","Instagram Spots","Hidden Gems","Nightlife"]},
        {q:"Transport?",opts:["Train Journey","Road Trip","First Class","Walking","Scooter"]},
        {q:"Morning Habit?",opts:["Sleep In","Sunrise Hike","Hotel Breakfast","Sightseeing","Gym"]},
        {q:"Vibe?",opts:["Solo Discovery","Romantic","Family","Group Party","Guided"]},
        {q:"Worst Mishap?",opts:["Lost Passport","Missed Flight","Food Sickness","Bad Weather","Lost Bag"]},
        {q:"Dream Region?",opts:["East Asia","Europe","South America","Scandinavia","Islands"]},
        {q:"Accommodation?",opts:["Luxury Resort","Airbnb","Hostel","Camping","Cruise"]},
        {q:"Souvenir?",opts:["Local Art","Postcards","Magnets","Clothing","Local Food"]},
    ],
    career: [
        {q:"Environment?",opts:["Modern Office","Remote/Home","Coworking","Outdoors","Creative Studio"]},
        {q:"Work Value?",opts:["High Salary","Balance","Impact/Purpose","Security","Freedom"]},
        {q:"Success Metric?",opts:["Wealth","Free Time","Innovation","Respect","Happiness"]},
        {q:"Leader Style?",opts:["Front-line","Trusting","Collaborative","Goal-driven","Mentor"]},
        {q:"Motivation?",opts:["Promotion","Learning","Helping","Money","Recognition"]},
        {q:"Perk?",opts:["Free Food","Gym","Remote Work","Flex Hours","Bonuses"]},
        {q:"Stress Relief?",opts:["Vent to Peers","Work Harder","Take Break","Lists","Ignore It"]},
        {q:"Company Size?",opts:["Corporate","Mid-size","Startup","Freelance","Non-Profit"]},
        {q:"Meeting Vibe?",opts:["Efficient","Creative","Formal","Social","Educational"]},
        {q:"Lunch Break?",opts:["Working Lunch","Outside Walk","Nap","Socializing","Gym"]},
    ],
    romance: [
        {q:"First Date?",opts:["Fine Dining","Coffee","Arcade","Picnic","Movie"]},
        {q:"Love Language?",opts:["Words","Service","Gifts","Quality Time","Touch"]},
        {q:"Ideal Gesture?",opts:["Love Letter","Surprise Trip","Home Meal","Gift","Hugs"]},
        {q:"Future Home?",opts:["Penthouse","Cottage","Beach House","Suburban","Van Life"]},
        {q:"Conflict Style?",opts:["Talk it out","Cooling off","Note writing","Humor","Physical"]},
        {q:"Morning?",opts:["Cuddles","Coffee","Gym together","Breakfast","Reading"]},
        {q:"PDA Level?",opts:["Hand-holding","Arm-around","Kisses","Whispers","Private only"]},
        {q:"Weekend?",opts:["Party","Movie Night","Exploring","Sleeping In","Cleaning"]},
        {q:"Gift Vibe?",opts:["Practical","Experience","Sentimental","Luxury","Handmade"]},
        {q:"Bonding?",opts:["Secrets","Support","Values","Humor","Hardship"]},
    ],
    personal: [
        {q:"Social Battery?",opts:["Introvert","Extrovert","Selective","Ambivert","Homebody"]},
        {q:"Decision?",opts:["Logic","Emotion","Coin Flip","Ask Others","Gut"]},
        {q:"Biggest Fear?",opts:["Failure","Loneliness","Pain","Speaking","Control"]},
        {q:"Motto?",opts:["YOLO","Stay Humble","Work Hard","Be Kind","Keep it Simple"]},
        {q:"Brain Type?",opts:["Creative","Analytical","Emotional","Trivia","Practical"]},
        {q:"Power?",opts:["Flight","Invisibility","Time Travel","Mind Reading","Teleport"]},
        {q:"Cleanliness?",opts:["Minimalist","Org Chaos","Clean Freak","Clutter","Hidden"]},
        {q:"Humor?",opts:["Sarcastic","Puns","Dark","Slapstick","Dry"]},
        {q:"Phone?",opts:["Always on","No-notifs","Scroller","Caller","Texter"]},
        {q:"Season?",opts:["Spring","Summer","Autumn","Winter","Stormy"]},
    ]
};

let peer, conn, role, idx=0, max=10, mode="gaming", truth=null, locked=false;
let scores = { host: 0, guest: 0 }, deck = [], currentDesigner="host";

function show(id) { 
    document.querySelectorAll(".container > div:not(#status):not(#live-points)").forEach(d => d.classList.add("hidden")); 
    document.getElementById(id).classList.remove("hidden"); 
}

function startHost() {
    mode = document.getElementById("mode-select").value;
    max = parseInt(document.getElementById("round-select").value);
    let pool = (mode==='chaos') ? [].concat(...Object.values(bank)) : [...bank[mode]];
    deck = pool.sort(() => Math.random() - 0.5).slice(0, max);
    
    peer = new Peer(Math.floor(1000 + Math.random() * 9000) + ""); role = "host";
    peer.on("open", id => { document.getElementById("room-id").innerText = id; show("screen-wait"); });
    peer.on("connection", c => { conn = c; setup(); });
}

function startJoin() {
    peer = new Peer(); role = "guest";
    peer.on("open", () => { 
        conn = peer.connect(document.getElementById("join-id").value); setup(); 
    });
}

function setup() {
    conn.on("open", () => { 
        document.getElementById("status").innerText = "Connection Live";
        document.getElementById("live-points").classList.remove("hidden");
        if(role === "guest") conn.send({ type: "READY" }); 
    });
    conn.on("data", d => {
        if(d.type === "READY" && role === "host") { conn.send({ type: "START", mode, max, deck }); round(); }
        if(d.type === "START") { mode = d.mode; max = d.max; deck = d.deck; round(); }
        if(d.type === "TRUTH") { truth = d.order; ui(); }
        if(d.type === "GUESS") { reveal(truth, d.order); }
        if(d.type === "NEXT") { idx = d.i; (idx >= max) ? finalize() : round(); }
        if(d.type === "SYNC_SCORE") { scores = d.scores; updateScore(); }
        if(d.type === "STEAL") { currentDesigner = (role === "host") ? "guest" : "host"; replay(); }
    });
}

function updateScore() {
    document.getElementById("p-host-score").innerText = `Host: ${scores.host}`;
    document.getElementById("p-guest-score").innerText = `Guest: ${scores.guest}`;
}

function round() {
    truth = null; locked = false;
    currentDesigner = (idx % 2 === 0) ? "host" : "guest";
    replay();
}

function replay() {
    locked = false; truth = null;
    document.getElementById("question").innerText = deck[idx].q;
    document.getElementById("round-info").innerText = `Round ${idx + 1} of ${max}`;
    
    if(role === currentDesigner) {
        render(deck[idx].opts);
    } else {
        document.getElementById("rank-list").innerHTML = `
            <div style="padding:40px; border:2px dashed #334155; border-radius:20px; opacity:0.5;">
                Partner is ranking their truth...
            </div>`;
    }
    ui(); show("screen-game");
}

function ui() {
    const isCr = (role === currentDesigner);
    const tag = document.getElementById("role-tag");
    tag.innerText = isCr ? "‚≠ê SET YOUR TRUTH" : (truth ? "üîç MAKE YOUR GUESS" : "‚åõ WAITING...");
    tag.style.color = isCr ? "var(--p2)" : "var(--p1)";
    document.getElementById("submit").classList.toggle("hidden", !isCr && !truth);
    document.getElementById("submit").disabled = locked;
}

function sendOrder() {
    const order = [...document.querySelectorAll(".rank-item")].map(x => x.innerText);
    locked = true; ui();
    if(!truth) { truth = order; conn.send({ type: "TRUTH", order }); }
    else { conn.send({ type: "GUESS", order }); reveal(truth, order); }
}

function reveal(t, g) {
    const list = document.getElementById("result-list"); list.innerHTML = ""; 
    let pts = 0;
    t.forEach((x, i) => {
        const actualPos = g.indexOf(x);
        const diff = Math.abs(i - actualPos);
        if(diff === 0) pts += 2; else if(diff === 1) pts += 1;
        
        let div = document.createElement("div"); 
        div.style = "display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #334155;";
        div.innerHTML = `<span style="font-size:0.9rem;">${x}</span>
                         <span style="font-weight:bold; color:${diff===0?'var(--success)':'var(--text)'}">Rank #${actualPos+1}</span>`;
        list.appendChild(div);
    });

    if(role === "host") {
        scores[(currentDesigner==='host'?'guest':'host')] += pts;
        conn.send({ type: "SYNC_SCORE", scores });
        updateScore();
    }

    document.getElementById("res-score").innerText = `+${pts} Points!`;
    const ctrl = document.getElementById("controls"); ctrl.innerHTML = "";
    
    // Role Swap / Steal Button
    if (role !== currentDesigner) {
        let b = document.createElement("button"); b.className="btn-alt"; b.innerText="üîÑ Steal Turn (My Truth)";
        b.onclick = () => { conn.send({type:"STEAL"}); currentDesigner=role; replay(); }; ctrl.appendChild(b);
    }
    // Next Round (Host only)
    if(role === "host") {
        let b = document.createElement("button"); b.className="btn-main"; b.innerText=(idx+1 >= max)?"See Final Winner":"Next Round ‚Üí";
        b.onclick = () => { idx++; conn.send({type:"NEXT", i:idx}); (idx >= max) ? finalize() : round(); }; ctrl.appendChild(b);
    }
    show("screen-results");
}

function finalize() {
    show("screen-final");
    const win = document.getElementById("winner-name");
    const stats = document.getElementById("final-stats");
    let winner = scores.host > scores.guest ? "HOST" : "GUEST";
    if(scores.host === scores.guest) winner = "BOTH! It's a tie.";
    win.innerText = `${winner} DOMINATES!`;
    stats.innerHTML = `<h2>Final: ${scores.host} vs ${scores.guest}</h2><p>Compatibility: ${Math.round(((scores.host+scores.guest)/(max*10))*100)}%</p>`;
}

function render(opts) {
    const rl = document.getElementById("rank-list"); rl.innerHTML = "";
    [...opts].sort(()=>Math.random()-0.5).forEach(t => {
        const d = document.createElement("div"); d.className = "rank-item"; d.innerText = t; rl.appendChild(d);
    });
}

// Global Touch/Drag Engine
let active = null;
document.addEventListener("pointerdown", e => { if(e.target.classList.contains("rank-item") && !locked) { active = e.target; active.classList.add("active"); } });
document.addEventListener("pointermove", e => {
    if(!active) return;
    let target = document.elementFromPoint(e.clientX, e.clientY);
    if(target && target.classList.contains("rank-item") && target !== active) {
        let rect = target.getBoundingClientRect();
        if(e.clientY > rect.top + rect.height/2) target.after(active);
        else target.before(active);
    }
});
document.addEventListener("pointerup", () => { if(active) active.classList.remove("active"); active = null; });
</script>
</body>
</html>
